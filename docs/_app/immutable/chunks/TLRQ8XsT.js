import{t as z,a as k,c as ve,n as $t}from"./CB0lZw64.js";import{i as me}from"./36iwJYuS.js";import{p as pe,o as ge,T as O,V as _e,W as H,a as xe,X as b,Y,m as l,n as x,e as t,Z as it,_ as Nt,$ as T,a0 as yt,d as C}from"./EIGgl-ut.js";import{e as S,s as $}from"./CBrunzHD.js";import{i as et}from"./BZLUw1rn.js";import{e as Tt,s as f,i as wt}from"./Diwdagdi.js";import{s as Xt}from"./W_8ns1rb.js";import{p as Ht}from"./bkRm03nm.js";var be=$t('<line class="time-marker-line svelte-1mf97ri"></line><text text-anchor="middle" class="time-marker svelte-1mf97ri"> </text>',1),Me=$t('<g role="button" tabindex="0" class="svelte-1mf97ri"><text text-anchor="middle" class="event-label svelte-1mf97ri"> </text><rect rx="3" ry="3" class="event-bar svelte-1mf97ri"></rect><line stroke="#555" stroke-width="0.5" stroke-dasharray="2 2"></line></g>'),ye=z('<p class="subtitle svelte-1mf97ri"> </p>'),Te=z("<br> ",1),we=z('<span class="tag svelte-1mf97ri"> </span>'),Xe=z('<div class="tags svelte-1mf97ri"></div>'),Ee=z('<div class="event-popup svelte-1mf97ri"><button class="close-btn svelte-1mf97ri">Ã—</button> <h4 class="svelte-1mf97ri"> </h4> <!> <div class="time-label svelte-1mf97ri"> <!></div> <!></div>'),Ye=z('<div class="event-timeline-container svelte-1mf97ri" role="application" aria-label="Interactive event timeline - click and drag to pan, scroll to zoom"><div class="timeline-content svelte-1mf97ri"><svg class="svelte-1mf97ri"><rect x="0" y="0" fill="#17191C"></rect><!><line class="main-timeline svelte-1mf97ri"></line><!></svg></div> <!></div>');function Oe(Lt,ct){pe(ct,!1);const M=x(),R=x(),Ut=x(),lt=x(),W=x(),L=x(),D=x(),Et=x();let U=Ht(ct,"items",8),nt=Ht(ct,"scaleType",8,"linear");const y=60,B=500,G=12,Yt=35,St=60,Gt=8,ut=20,qt=4e3,zt=4e3;let ft=x(0);const j=-66e6,K=-2e6,q=-1e4,jt=.15,Kt=.2,Vt=.3,Zt=.35;function P(e,n=1e9){return Math.asinh(e/n)}function I(e){const n=t(W)-y*2;if(nt()==="log"){const s=n*jt,o=n*Kt,r=n*Vt,i=n*Zt;if(e<=j){const u=P(t(M),1e8),a=P(j,1e8),v=(P(e,1e8)-u)/(a-u);return y+v*s}else if(e<=K){const u=P(j,1e6),a=P(K,1e6),v=(P(e,1e6)-u)/(a-u);return y+s+v*o}else if(e<=q){const u=P(K,1e4),a=P(q,1e4),v=(P(e,1e4)-u)/(a-u);return y+s+o+v*r}else{const c=(e-q)/(t(R)-q);return y+s+o+r+c*i}}else{const s=(e-t(M))/(t(R)-t(M));return y+s*n}}function Jt(){const e=[],n=t(R)-t(M);if(nt()==="log"){const r=[-138e8,-45e8,-38e8,-541e6,-252e6,-66e6];for(const a of r)a>=t(M)&&a<=j&&e.push(a);const i=[-5e7,-2e7,-1e7,-5e6,-2e6];for(const a of i)a>j&&a<=K&&e.push(a);const c=[-15e5,-1e6,-5e5,-2e5,-1e5,-5e4,-2e4,-1e4];for(const a of c)a>K&&a<=q&&e.push(a);const u=[-8e3,-5e3,-3e3,-2e3,-1e3,-500,0,500,1e3,1500,2e3];for(const a of u)a>q&&a<=t(R)&&e.push(a)}else{let r;n>1e4?r=2e3:n>5e3?r=1e3:n>1e3?r=500:n>500?r=100:r=50;const i=Math.ceil(t(M)/r)*r;for(let c=i;c<=t(R);c+=r)e.push(c)}e.sort((r,i)=>r-i);const s=60,o=[];for(let r=0;r<e.length;r++){const i=e[r],c=I(i);let u=!0;if(r>0){for(let a=r-1;a>=0;a--)if(o[a].above===u){const d=I(o[a].value);Math.abs(c-d)<s&&(u=!1);break}if(!u){for(let a=r-1;a>=0;a--)if(!o[a].above){const d=I(o[a].value);Math.abs(c-d)<s&&(u=!0);break}}}o.push({value:i,above:u})}return o}function Dt(e){const n=Math.abs(e);if(n>=1e9)return`${(e/1e9).toFixed(1)} Ga`;if(n>=1e6)return`${(e/1e6).toFixed(1)} Ma`;if(n>=1e3){const s=Math.abs(e).toLocaleString();return e<0?`${s} BC`:`${s} AD`}else return e<0?`${Math.abs(e)} BC`:`${e} AD`}let m=x(null),ht=x(0),dt=x(0),V=!1,It=0,At=0,w=x(0),X=x(0),Ct=0,Pt=0,p=null,Z=0,st=1,g=x(1),J=!1,vt=0,mt=0,pt=0,gt=0,_t=0,xt=0,Ft=0,kt=0;ge(()=>{if(p=document.querySelector(".event-timeline-container"),p){l(ft,p.clientWidth);const e=p.clientWidth/t(W),n=p.clientHeight/t(L),s=Math.min(e,n)*.9;l(g,Math.max(.3,Math.min(10,s)));const o=t(W)*t(g),r=t(L)*t(g);l(w,(p.clientWidth-o)/2),l(X,(p.clientHeight-r)/2)}});function Qt(e){e.target.closest(".event-bar, .event-label, .event-popup")||(t(m)&&l(m,null),V=!0,It=e.clientX,At=e.clientY,Ct=t(w),Pt=t(X),p&&(p.style.cursor="grabbing"))}function te(e){if(!V)return;e.preventDefault();const n=e.clientX-It,s=e.clientY-At;l(w,Ct+n),l(X,Pt+s)}function ee(){V=!1,p&&(p.style.cursor="grab")}function ne(){V&&(V=!1,p&&(p.style.cursor="grab"))}function se(e){e.preventDefault();const o=1+-e.deltaY*.002,r=Math.max(.1,Math.min(20,t(g)*o));if(r!==t(g))if(p){const i=p.getBoundingClientRect(),c=e.clientX-i.left,u=e.clientY-i.top,a=(c-t(w))/t(g),d=(u-t(X))/t(g);l(g,r),l(w,c-a*t(g)),l(X,u-d*t(g))}else l(g,r)}function Ot(e){const n=e[0].clientX-e[1].clientX,s=e[0].clientY-e[1].clientY;return Math.sqrt(n*n+s*s)}function oe(e){return{x:(e[0].clientX+e[1].clientX)/2,y:(e[0].clientY+e[1].clientY)/2}}function ae(e){if(!e.target.closest(".event-bar, .event-label, .event-popup")){if(e.touches.length===1)e.preventDefault(),J=!0,vt=e.touches[0].clientX,mt=e.touches[0].clientY,pt=t(w),gt=t(X),t(m)&&l(m,null);else if(e.touches.length===2&&(e.preventDefault(),J=!1,Z=Ot(e.touches),st=t(g),p)){const n=p.getBoundingClientRect(),s=oe(e.touches);_t=s.x-n.left,xt=s.y-n.top,Ft=t(w),kt=t(X)}}}function re(e){if(e.touches.length===1&&J){e.preventDefault();const n=e.touches[0].clientX-vt,s=e.touches[0].clientY-mt;l(w,pt+n),l(X,gt+s)}else if(e.touches.length===2&&Z>0){e.preventDefault();const s=Ot(e.touches)/Z,o=Math.max(.1,Math.min(20,st*s));if(o!==t(g)&&p){const r=(_t-Ft)/st,i=(xt-kt)/st;l(g,o),l(w,_t-r*t(g)),l(X,xt-i*t(g))}}}function ie(e){e.touches.length===0?(J=!1,Z=0):e.touches.length===1&&(Z=0,J=!0,vt=e.touches[0].clientX,mt=e.touches[0].clientY,pt=t(w),gt=t(X))}function ce(e,n){l(m,e);const s=Rt(n.clientX,n.clientY);l(ht,s.x),l(dt,s.y),n.stopPropagation()}function le(e,n){if(n.key==="Enter"||n.key===" "){n.preventDefault(),l(m,e);const s=n.target.getBoundingClientRect(),o=Rt(s.left+s.width/2,s.top+s.height/2);l(ht,o.x),l(dt,o.y)}}function Rt(e,n){const s={width:300,height:200},o=20;let r=e,i=n;return r+s.width/2>window.innerWidth-o&&(r=window.innerWidth-s.width/2-o),r-s.width/2<o&&(r=s.width/2+o),i+s.height/2>window.innerHeight-o&&(i=window.innerHeight-s.height/2-o),i-s.height/2<o&&(i=s.height/2+o),{x:r,y:i}}function ue(e){const n=e.tags||[];return n.includes("extinction")?"#EF4444":n.includes("war")?"#DC2626":n.includes("biology")?"#22C55E":n.includes("humanity")?"#F59E0B":n.includes("politics")?"#6366F1":n.includes("religion")||n.includes("philosophy")?"#8B5CF6":n.includes("science")||n.includes("technology")?"#3B82F6":n.includes("culture")||n.includes("art")?"#EC4899":n.includes("economy")?"#14B8A6":n.includes("cosmology")||n.includes("astronomy")||n.includes("physics")?"#06B6D4":n.includes("earth")||n.includes("chemistry")?"#84CC16":"#FA6742"}O(()=>it(U()),()=>{l(M,Math.min(...U().map(e=>e.start)))}),O(()=>it(U()),()=>{l(R,Math.max(...U().map(e=>e.end)))}),O(()=>t(M),()=>{l(Ut,t(M)<0?Math.abs(t(M))+1:0)}),O(()=>(it(nt()),t(R),t(M)),()=>{l(lt,nt()==="log"?zt:Math.max(qt,(t(R)-t(M))*.2))}),O(()=>(t(lt),t(ft)),()=>{l(W,Math.max(t(lt),t(ft)/.5)+y*4)}),O(()=>{},()=>{l(L,B+y*3+ut*2*(G+Yt))}),O(()=>it(U()),()=>{l(D,[...U()].sort((e,n)=>e.start-n.start))}),O(()=>{},()=>{l(Et,Jt())}),O(()=>t(D),()=>{const e=[],n=[];for(let o=0;o<t(D).length;o++)o%2===0?(e.push(t(D)[o]),Nt(D,t(D)[o].placement="top")):(n.push(t(D)[o]),Nt(D,t(D)[o].placement="bottom"));function s(o){var r;o.sort((i,c)=>i.start-c.start);for(let i=0;i<o.length;i++){const c=o[i],u=I(c.start),a=I(c.end),d=(((r=c.title)==null?void 0:r.length)||0)*7;let v=!1,A=1;for(;!v&&A<=ut;)o.some((h,_)=>{var Bt;if(_>=i||h.row!==A)return!1;const N=I(h.start),Mt=I(h.end),tt=(((Bt=h.title)==null?void 0:Bt.length)||0)*7,rt=80+Math.max(d,tt)/2;return u<=Mt+rt&&a>=N-rt})?A++:(c.row=A,v=!0);v||(c.row=ut)}}s(e),s(n)}),_e(),me();var E=Ye(),ot=Y(E),at=Y(ot),bt=Y(at),Wt=b(bt);Tt(Wt,1,()=>t(Et),wt,(e,n)=>{var s=ve();const o=C(()=>I(t(n).value));var r=yt(s);{var i=c=>{var u=be(),a=yt(u);f(a,"y1",0);var d=b(a),v=Y(d,!0);T(d),H(A=>{f(a,"x1",t(o)),f(a,"x2",t(o)),f(a,"y2",t(L)),f(d,"x",t(o)),f(d,"y",t(n).above?B-15:B+25),$(v,A)},[()=>Dt(t(n).value)],C),k(c,u)};et(r,c=>{t(o)>=y&&t(o)<=t(W)-y&&c(i)})}k(e,s)});var Q=b(Wt);f(Q,"x1",y),f(Q,"y1",B),f(Q,"y2",B);var fe=b(Q);Tt(fe,1,()=>t(D),wt,(e,n)=>{var s=Me();const o=C(()=>I(t(n).start)),r=C(()=>I(t(n).end)),i=C(()=>Math.max(t(r)-t(o),8)),c=C(()=>t(n).placement==="top"),u=C(()=>(t(n).row-1)*(G+Yt)),a=C(()=>t(c)?B-St-t(u)-G:B+St+t(u)),d=C(()=>ue(t(n)));var v=Y(s),A=Y(v,!0);T(v);var F=b(v);f(F,"height",G);var h=b(F);T(s),H(()=>{f(s,"aria-label",t(n).title),f(v,"x",t(o)+t(i)/2),f(v,"y",t(a)+(t(c)?-8:G+Gt+4)),$(A,t(n).title),f(F,"x",t(o)),f(F,"y",t(a)),f(F,"width",t(i)),Xt(F,`fill: ${t(d)??""}`),f(h,"x1",t(o)+t(i)/2),f(h,"y1",t(a)+(t(c)?G:0)),f(h,"x2",t(o)+t(i)/2),f(h,"y2",B+(t(c)?-3:3))}),S("click",s,_=>ce(t(n),_)),S("keydown",s,_=>le(t(n),_)),k(e,s)}),T(at),T(ot);var he=b(ot,2);{var de=e=>{var n=Ee(),s=Y(n),o=b(s,2),r=Y(o,!0);T(o);var i=b(o,2);{var c=h=>{var _=ye(),N=Y(_,!0);T(_),H(()=>$(N,t(m).subtitle)),k(h,_)};et(i,h=>{t(m).subtitle&&h(c)})}var u=b(i,2),a=Y(u),d=b(a);{var v=h=>{var _=Te(),N=b(yt(_),1,!0);H(()=>$(N,t(m).region)),k(h,_)};et(d,h=>{t(m).region&&h(v)})}T(u);var A=b(u,2);{var F=h=>{var _=Xe();Tt(_,5,()=>t(m).tags,wt,(N,Mt)=>{var tt=we(),rt=Y(tt,!0);T(tt),H(()=>$(rt,t(Mt))),k(N,tt)}),T(_),k(h,_)};et(A,h=>{t(m).tags&&t(m).tags.length>0&&h(F)})}T(n),H(h=>{Xt(n,`left: ${t(ht)??""}px; top: ${t(dt)??""}px;`),$(r,t(m).title),$(a,`${h??""} `)},[()=>t(m).labelTime||Dt(t(m).start)],C),S("click",s,()=>l(m,null)),k(e,n)};et(he,e=>{t(m)&&e(de)})}T(E),H(()=>{Xt(ot,`transform: translate(${t(w)??""}px, ${t(X)??""}px) scale(${t(g)??""}); transform-origin: 0 0;`),f(at,"width",t(W)),f(at,"height",t(L)),f(bt,"width",t(W)),f(bt,"height",t(L)),f(Q,"x2",t(W)-y)}),S("mousedown",E,Qt),S("mousemove",E,te),S("mouseup",E,ee),S("mouseleave",E,ne),S("wheel",E,se),S("touchstart",E,ae),S("touchmove",E,re),S("touchend",E,ie),k(Lt,E),xe()}export{Oe as E};
